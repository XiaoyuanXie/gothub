<html>
  <head>
    <title>Exploring Home Mortgages</title>
    <script type="text/javascript" src="http://polymaps.org/protodata.min.js?3.2"></script>
    <script type="text/javascript" src="http://polymaps.org/polymaps.min.js?2.2.0"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
	<!--<script type="text/javascript" src="map.js"></script>-->
	   <style type="text/css">

	@import url("../example.css");

	.layer path {
	  fill: lightsteelblue;
	  fill-opacity: .5;
	  stroke: steelblue;
	}

	.layer circle {
	  fill: lightcoral;
	  fill-opacity: .5;
	  stroke: brown;
	}

	    </style>
  </head>
  <body>
    <div id="map">
    </div>
	   <script type="text/javascript">
map = null;
po = org.polymaps;

$(function(){

	map = po.map()
	    .container(document.getElementById("map").appendChild(po.svg("svg")))
	    .center({lat: 37.787, lon: -122.228})
	    .zoom(12)
	    .add(po.interact());

	map.add(po.image()
	    .url(po.url("http://{S}tile.cloudmade.com"
	    + "/1a1b06b230af4efdbb989ea99e9841af" // http://cloudmade.com/register
	    + "/998/256/{Z}/{X}/{Y}.png")
	    .hosts(["a.", "b.", "c.", ""]))
	);

/*	map.add(po.geoJson()
	    .features([

	{
	  "geometry": {
	    "coordinates": [-122.289365, 37.816873],
	    "type": "Point"
	  }
	},
	{
	  "geometry": {
	    "coordinates": [[[
	      [-122.289365, 37.816873],
	      [-122.273176, 37.812709],
	      [-122.278686, 37.807282],
	      [-122.291530, 37.810804],
	      [-122.289365, 37.816873]
	    ]]],
	    "type": "MultiPolygon"
	  },
	  "type": "Feature",
	  "id": "beat:05X",
	  "properties": {"name": "05X"}
	},
	{
	  "geometry": {
	    "coordinates": [-121.289365, 37.816873],
	    "type": "Point"
	  }
	},
	{
	  "geometry": {
	    "coordinates": [-121.289365, 37.816873],
	    "type": "Point"
	  }
	},
	{
		"geometry" : { "type": "LineString",
		  "coordinates": [ [100.0, 0.0], [101.0, 1.0] ]
		  }
	}
	    ]).on("load", 
				po.stylist().attr("stroke", function(d) { return "green"; })
							.attr("stroke-width", function(d) { return 5;})
							.attr("stroke-opacity", function(d) { return 0.2;})
			)
	);
*/
	map.add(po.compass()
	    .pan("none"));
	
	$.ajax({
		        url: 'http://nfcm5:8080/query?project=rails&sort=1',
		        dataType: "jsonp",
				jsonpCallback: "jsonpcallback",
		        success: function(data, status)
				{
					geoData.setData(data);
					geoData.showNext();
				}

	});
	
});

var geoData = (function()
{
	var data;
	var idx = 0;
	var point = null;
	var timeout = null;
	
	var showNext = function()
	{
		if (point != null)
			map.remove(point)
		var obj = data[idx];
		idx = idx + 1;
		point = po.geoJson().features([
			{
			  "geometry": {
			    "coordinates": [obj.long, obj.lat],
			    "type": "Point"
			  }
			}]);
		map.add(point);
		timeout = setTimeout("geoData.showNext()", 100);
	};
	
	var setData = function(theData)
	{
		data = theData;
	};
	
	var stop = function()
	{
		clearTimeout(timeout);
	};
	
	return {
		setData : setData,
		showNext : showNext,
		stop : stop
	};
})();



	    </script>
  </body>
</html>
