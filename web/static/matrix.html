<html>
  <head>
    <title>Matrix Diagram</title>
    <script type="text/javascript" src="protovis-r3.2.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
    <style type="text/css">
      #fig {
        width: 800px;
        height: 800px;
      }
    </style>
  </head>
  <body><div id="center"><div id="fig">
    <script type="text/javascript+protovis">

//var color = pv.Colors.category19().by(function(d) d.group);
var color = function(v) {
  if (v < 2) return "#D73027";
  if (v < 5) return "#FC8D59";
  if (v < 8) return "#FEE090";
  if (v < 11) return "#FFFFBF";
  if (v < 14) return "#E0F3F8";
  if (v < 17) return "#91BFDB";
  /* else */ return "#4575B4";
};

var vis = new pv.Panel()
    .width(693)
    .height(693)
    .top(90)
    .left(90);

var degree = function(name, type) {
  var nodeIndex = undefined;
  $.each(data.nodes, function(index, node) {
    if (node.nodeName == name) {
      nodeIndex = index;
      return false;
    }
  });
  var degree = $.grep(data.links, function(link, index) {
    if (link[type] == nodeIndex) return true;
    return false;
  }).length;
  //console.log(degree);
  return degree;
};

var complement = function(source, target) {
  var results = $.grep(data.links, function(link, index) {
    if (link.source == target && link.target == source) {
      return true;
    }
  });
  var sum = 0;
  if (results.length > 0) {
    console.log(results.length);
    $.each(results, function(index, link) {
      sum += link.value;
    });
    return sum;
  } else {
    return 0;
  }
}

var layout = vis.add(pv.Layout.Matrix)
    .nodes(data.nodes)
    .links(data.links)
    .sort(function(a, b) degree(b.nodeName, 'source') - degree(a.nodeName, 'source'));

layout.link.add(pv.Bar)
    .fillStyle(function(l) color((degree(l.sourceNode.nodeName, 'source') - degree(l.sourceNode.nodeName, 'target')) + (degree(l.targetNode.nodeName, 'source') - degree(l.targetNode.nodeName, 'target'))))
    .antialias(false)
    .lineWidth(1);

layout.label.add(pv.Label)
    .textStyle(color);

vis.render();

    </script>
  </div></div></body>
</html>
